{
  "deployment_date": "{{ ansible_date_time.iso8601 }}",
  "version": "{{ app_version | default('latest') }}",
  "environment": "{{ environment }}",
  "server_info": {
    "hostname": "{{ ansible_hostname }}",
    "ip_address": "{{ ansible_host }}",
    "user": "{{ ansible_user }}",
    "os": "{{ ansible_distribution }} {{ ansible_distribution_version }}",
    "kernel": "{{ ansible_kernel }}"
  },
  "application": {
    "project_dir": "{{ project_dir }}",
    "compose_file": "{{ compose_file }}",
    "debug_mode": {{ debug_mode | lower }},
    "log_level": "{{ log_level }}"
  },
  "services": {
    "backend": {
      "port": {{ backend_port }},
      "url": "http://{{ ansible_host }}:{{ backend_port }}",
      "health_endpoint": "http://{{ ansible_host }}:{{ backend_port }}/health",
      "api_docs": "http://{{ ansible_host }}:{{ backend_port }}/api/docs"
    },
    "database": {
      "type": "MySQL",
      "port": {{ mysql_port }},
      "name": "{{ mysql_database }}",
      "container": "{{ database_container_name }}"
    },
    "phpmyadmin": {
      "port": {{ phpmyadmin_port }},
      "url": "http://{{ ansible_host }}:{{ phpmyadmin_port }}"
    }{% if environment == 'production' %},
    "domain": {
      "name": "{{ domain_name }}",
      "frontend_url": "https://{{ domain_name }}",
      "api_url": "{{ api_url }}"
    }{% if monitoring_enabled %},
    "monitoring": {
      "prometheus": {
        "port": {{ prometheus_port }},
        "url": "http://{{ ansible_host }}:{{ prometheus_port }}"
      },
      "grafana": {
        "port": {{ grafana_port }},
        "url": "http://{{ ansible_host }}:{{ grafana_port }}",
        "admin_user": "{{ grafana_admin_user }}"
      },
      "cadvisor": {
        "port": {{ cadvisor_port }},
        "url": "http://{{ ansible_host }}:{{ cadvisor_port }}"
      }
    }{% endif %}{% if redis_enabled | default(false) %},
    "cache": {
      "type": "Redis",
      "port": {{ redis_port }},
      "enabled": true
    }{% endif %}{% endif %}
  },
  "features": {
    "backup_enabled": {{ backup_enabled | lower }},
    "monitoring_enabled": {{ monitoring_enabled | lower }},
    "ssl_enabled": {{ ssl_enabled | lower }}{% if environment == 'production' %},
    "rate_limiting": {{ rate_limiting | lower }},
    "secure_cookies": {{ secure_cookies | lower }}{% endif %}
  },
  "configuration": {
    "cors_origins": {{ cors_origins | to_json }},
    "max_file_size_mb": {{ max_file_size_mb }},
    "allowed_file_types": {{ allowed_file_types | to_json }},
    "cache_ttl": {{ cache_ttl }}{% if environment == 'production' %},
    "worker_processes": {{ worker_processes }},
    "max_connections": {{ max_connections }},
    "session_timeout": {{ session_timeout }},
    "backup_retention_days": {{ backup_retention_days | default('N/A') }}{% endif %}
  },{% if backup_enabled and backup_timestamp is defined %}
  "backup_info": {
    "last_backup": "{{ backup_timestamp }}",
    "backup_dir": "{{ backup_dir }}",
    "retention_days": {{ backup_retention_days }},
    "compression": {{ backup_compression | lower }}
  },{% endif %}
  "deployment_metadata": {
    "ansible_version": "{{ ansible_version.full }}",
    "deploy_user": "{{ ansible_user }}",
    "playbook_dir": "{{ playbook_dir | default('unknown') }}",
    "inventory_hostname": "{{ inventory_hostname }}",
    "docker_network": "{{ docker_network_name }}",
    "github_repository": "{{ github_repository_owner }}/blogapp"
  }
}
